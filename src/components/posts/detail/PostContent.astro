---
import PostHeader from './PostHeader.astro';
import TableOfContents from './TableOfContents.tsx';
import type { PostTag } from '@api/ghost/types';

interface Props {
    title: string;
    feature_image: URL;
    primary_tag?: PostTag | undefined;
    tags?: PostTag[] | undefined;
    published_at: string;
    html: string;
}

const { title, feature_image, primary_tag, tags, published_at, html } =
    Astro.props;
const featureImageUrl = feature_image?.toString() || '';
---

<div class="solitude-article-container grid grid-cols-1 lg:grid-cols-12">
    <!-- 左侧 TOC 区域 - 在移动端和平板隐藏 -->
    <div class="solitude-article-rail hidden lg:col-span-2 lg:flex">
        <div class="toc-wrapper w-full">
            <TableOfContents client:idle />
        </div>
    </div>

    <!-- 中间文章主体 - 移动端全宽，桌面端占8列 -->
    <div
        class="solitude-article-body col-span-1 pb-[100px] md:pb-[150px] lg:col-span-8 lg:pb-[200px]"
    >
        <div class="solitude-article-meta">
            <PostHeader
                title={title}
                primary_tag={primary_tag}
                tags={tags}
                published_at={published_at}
            />
        </div>
        <div>
            <div class="solitude-article-content" set:html={html} />
        </div>
    </div>

    <!-- 右侧空白区域 - 在移动端和平板隐藏 -->
    <div class="solitude-article-rail hidden lg:col-span-2 lg:block"></div>
</div>

<style
    define:vars={{
        featureImageUrl: featureImageUrl ? `url(${featureImageUrl})` : 'none',
    }}
>
    .solitude-article-meta {
        position: relative;
        background-size: cover;
        background-position: center;
        background-image: var(--featureImageUrl);
        border-radius: 0 0 24px 24px;
        margin-bottom: 2rem;
    }

    /* 遮罩层 - 使用 theme.css 的变量实现动态主题切换 */
    .solitude-article-meta::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(
            to bottom,
            var(--post-view-card-overlay-start) 0%,
            var(--post-view-card-overlay-mid) 50%,
            var(--post-view-card-overlay-end) 100%
        );
        pointer-events: none;
    }
</style>
