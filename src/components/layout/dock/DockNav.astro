---
import DockNavMobile from './DockNavMobile.tsx';
import RssSelector from '@components/common/RssSelector.tsx';
import { type Locale, DEFAULT_LOCALE, buildLocalePath } from '@lib/i18n';

interface Props {
    lang?: Locale;
}

const { lang = DEFAULT_LOCALE } = Astro.props;

// 构建多语言链接
const homeLink = `/${lang}`;
const postsLink = buildLocalePath(lang, 'post-view');
const aboutLink = buildLocalePath(lang, 'about');
const contactLink = '/contact'; // Contact页面不需要多语言支持
const privacyLink = buildLocalePath(lang, 'privacy-policy');
---

<!-- 移动端汉堡菜单 - 小于768px -->
<div class="flex justify-center md:hidden">
    <DockNavMobile client:load />
</div>

<!-- 桌面端导航栏 - 768px及以上 -->
<div class="hidden md:grid md:justify-items-center">
    <div
        class:list={[
            'dock-nav',
            'text-color-ui flex items-center',
            'h-10 md:h-11 lg:h-12 xl:h-14',
            'min-h-[2.5rem] md:min-h-[2.75rem] lg:min-h-[3rem]',
            'w-auto max-w-full',
        ]}
    >
        <div class="dock-nav-item-left">
            <a
                href={homeLink}
                class="dock-nav-link text-xs font-medium whitespace-nowrap md:text-sm lg:text-base"
                >Home</a
            >
        </div>
        <div class="dock-nav-item">
            <a
                href={postsLink}
                class="dock-nav-link text-xs font-medium whitespace-nowrap md:text-sm lg:text-base"
                >Posts</a
            >
        </div>
        <div class="dock-nav-item">
            <a
                href={aboutLink}
                class="dock-nav-link text-xs font-medium whitespace-nowrap md:text-sm lg:text-base"
                >About</a
            >
        </div>
        <!-- Contact - md 时为右侧，lg+ 时为普通 -->
        <div class="dock-nav-item dock-nav-item-right-md">
            <a
                href={contactLink}
                class="dock-nav-link text-xs font-medium whitespace-nowrap md:text-sm lg:text-base"
                >Contact</a
            >
        </div>
        <!-- RSS 选择器 - lg 时为右侧，xl 时为普通 -->
        <div class="dock-nav-item dock-nav-item-right-lg hidden lg:flex">
            <RssSelector client:load showLabel={true} />
        </div>
        <!-- Privacy Policy 仅在大屏显示，xl+ 为右侧 -->
        <div class="dock-nav-item-right hidden xl:flex">
            <a
                href={privacyLink}
                class="dock-nav-link text-xs font-medium whitespace-nowrap md:text-sm lg:text-base"
                >Privacy</a
            >
        </div>
    </div>
</div>

<script>
    // 方向感知下划线效果
    function initDirectionalUnderline() {
        const items = document.querySelectorAll('.dock-nav-item');

        items.forEach((item) => {
            const link = item.querySelector('.dock-nav-link');
            if (!link) return;

            item.addEventListener('mouseenter', (e) => {
                const rect = item.getBoundingClientRect();
                const mouseX = (e as MouseEvent).clientX;
                const centerX = rect.left + rect.width / 2;

                // 根据鼠标进入位置判断方向
                const direction = mouseX < centerX ? 'left' : 'right';
                link.setAttribute('data-direction', direction);
            });
        });
    }

    // 页面加载时初始化
    initDirectionalUnderline();

    // 支持 Astro 视图过渡
    document.addEventListener('astro:after-swap', initDirectionalUnderline);
</script>
