---
import type { FeaturedPost } from '@api/ghost/types';
import PostsShowcaseCarousel, {
    PostsShowcaseSkeleton,
} from './PostsShowcaseCarousel';
import {
    filterPostsByLocale,
    type Locale,
    DEFAULT_LOCALE,
    buildLocalePath,
} from '@lib/i18n';

const MAX_POSTS = 8;

interface Props {
    featuredPosts: FeaturedPost[];
    /**
     * 当前语言
     */
    locale?: Locale;
    /**
     * 是否显示加载状态
     * @default false
     */
    isLoading?: boolean;
    /**
     * 自定义样式类名
     */
    className?: string;
}

const {
    featuredPosts,
    locale = DEFAULT_LOCALE,
    isLoading = false,
    className = '',
} = Astro.props;

// 按语言过滤文章：优先显示当前语言，如果没有则显示其他语言版本
const localizedPosts = filterPostsByLocale(featuredPosts || [], locale);
// 提取文章对象（已按发布日期排序）
const filteredPosts = localizedPosts.map((item) => item.post);
// 限制文章数量为最多8个
const limitedPosts = filteredPosts.slice(0, MAX_POSTS);
// 判断是否有更多文章
const hasMorePosts = filteredPosts.length > MAX_POSTS;
// 空数据且非加载状态时不渲染
const shouldRender = isLoading || (limitedPosts && limitedPosts.length > 0);
// 构建多语言文章列表页 URL
const postsPageUrl = buildLocalePath(locale, 'post-view');
---

{
    shouldRender && (
        <section
            class:list={['posts-showcase w-full', className]}
            aria-label="最近文章"
        >
            {isLoading ? (
                <PostsShowcaseSkeleton count={5} client:load />
            ) : (
                <PostsShowcaseCarousel
                    posts={limitedPosts}
                    postsPageUrl={postsPageUrl}
                    showMoreButton={hasMorePosts}
                    locale={locale}
                    client:load
                />
            )}
        </section>
    )
}

<style>
    .posts-showcase {
        /* 确保组件不会超出父容器 */
        max-width: 100%;
        overflow: hidden;
    }
</style>
