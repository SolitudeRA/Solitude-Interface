---
import type { FeaturedPost } from '@api/ghost/types';
import PostsShowcaseCarousel, { PostsShowcaseSkeleton } from './PostsShowcaseCarousel';

const MAX_POSTS = 8;
const POSTS_PAGE_URL = '/post-view';

interface Props {
    featuredPosts: FeaturedPost[];
    /**
     * 是否显示加载状态
     * @default false
     */
    isLoading?: boolean;
    /**
     * 自定义样式类名
     */
    className?: string;
}

const { featuredPosts, isLoading = false, className = '' } = Astro.props;

// 限制文章数量为最多8个
const limitedPosts = featuredPosts?.slice(0, MAX_POSTS) || [];
// 判断是否有更多文章
const hasMorePosts = featuredPosts && featuredPosts.length > MAX_POSTS;
// 空数据且非加载状态时不渲染
const shouldRender = isLoading || (limitedPosts && limitedPosts.length > 0);
---

{
    shouldRender && (
        <section
            class:list={['posts-showcase w-full', className]}
            aria-label="最近文章"
        >
            {isLoading ? (
                <PostsShowcaseSkeleton count={5} client:load />
            ) : (
                <PostsShowcaseCarousel 
                    posts={limitedPosts} 
                    postsPageUrl={POSTS_PAGE_URL}
                    showMoreButton={hasMorePosts}
                    client:load 
                />
            )}
        </section>
    )
}

<style>
    .posts-showcase {
        /* 确保组件不会超出父容器 */
        max-width: 100%;
        overflow: hidden;
    }
</style>
