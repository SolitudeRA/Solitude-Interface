---
import type { Post } from '@api/ghost/types';
import { type Locale, LOCALES, LOCALE_NAMES, buildPostPath } from '@lib/i18n';

interface Props {
    currentLocale: Locale;
    i18nKey: string;
    variants: Record<Locale, Post | null>;
}

const { currentLocale, i18nKey, variants } = Astro.props;
---

<nav class="mb-4 flex items-center gap-2" aria-label="Language switcher">
    <span class="mr-2 text-sm text-gray-500 dark:text-gray-400">
        {currentLocale === 'zh' && '语言：'}
        {currentLocale === 'ja' && '言語：'}
        {currentLocale === 'en' && 'Language:'}
    </span>
    <div class="flex gap-1">
        {
            LOCALES.map((locale) => {
                const isAvailable = variants[locale] !== null;
                const isCurrent = locale === currentLocale;
                const href = buildPostPath(locale, i18nKey);

                if (isCurrent) {
                    return (
                        <span
                            class="rounded-md bg-blue-600 px-3 py-1 text-sm font-medium text-white"
                            aria-current="true"
                        >
                            {LOCALE_NAMES[locale]}
                        </span>
                    );
                }

                if (isAvailable) {
                    return (
                        <a
                            href={href}
                            class="rounded-md bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"
                            hreflang={locale}
                        >
                            {LOCALE_NAMES[locale]}
                        </a>
                    );
                }

                return (
                    <span
                        class="cursor-not-allowed rounded-md bg-gray-100 px-3 py-1 text-sm font-medium text-gray-400 opacity-50 dark:bg-gray-800 dark:text-gray-500"
                        title={
                            currentLocale === 'zh'
                                ? `${LOCALE_NAMES[locale]} 版本暂不可用`
                                : currentLocale === 'ja'
                                  ? `${LOCALE_NAMES[locale]} 版はまだありません`
                                  : `${LOCALE_NAMES[locale]} version not available`
                        }
                    >
                        {LOCALE_NAMES[locale]}
                    </span>
                );
            })
        }
    </div>
</nav>
