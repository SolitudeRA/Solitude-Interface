---
import '@styles/index.css';
import type { AlternateLink } from '@lib/i18n';

interface Props {
    siteTitle: string;
    coverImageUrl: URL | string | null;
    lang?: string;
    canonicalUrl?: string;
    alternateLinks?: AlternateLink[];
}

const {
    siteTitle,
    coverImageUrl,
    lang = 'zh-CN',
    canonicalUrl,
    alternateLinks = [],
} = Astro.props;

const coverImageUrlStr = coverImageUrl ? `url(${coverImageUrl.toString()})` : 'none';
---

<!doctype html>
<html lang={lang}>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}
        {
            alternateLinks.map((link) => (
                <link
                    rel="alternate"
                    hreflang={link.hreflang}
                    href={link.href}
                />
            ))
        }
        <style data-emotion-insertion-point="emotion"></style>
        <title>{siteTitle}</title>
    </head>
    <body>
        <div class="solitude-body"></div>
        <slot />
    </body>
</html>

<style define:vars={{ coverImageUrlStr }}>
    .solitude-body {
        top: 0;
        left: 0;
        position: fixed;
        z-index: -10;
        height: 100vh;
        width: 100vw;
        background-size: cover;
        background-image: var(--coverImageUrlStr);
    }

    /* 遮罩层使用伪元素，颜色从 theme.css 动态加载 */
    .solitude-body::before {
        content: '';
        position: absolute;
        inset: 0;
        background-color: var(--site-bg-overlay);
        pointer-events: none;
    }
</style>

<script is:inline>
    const storedTheme = localStorage.getItem('theme');
    const themeMode = storedTheme ? JSON.parse(storedTheme) : 'dark';
    document.documentElement.classList.add(themeMode);

    // 监听主题切换事件
    window.addEventListener('themeChanged', function (e) {
        const newTheme = e.detail.theme;
        document.documentElement.classList.toggle('dark', newTheme === 'dark');
        document.documentElement.classList.toggle('light', newTheme === 'light');
    });
</script>
